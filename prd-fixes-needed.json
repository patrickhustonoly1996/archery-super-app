{
  "name": "Fixes Needed - Full Implementation",
  "description": "Complete all outstanding P1 and P2 fixes from FIXES_NEEDED.md including investigations, bug fixes, and new features",
  "branchName": "ralph/fixes-needed",
  "userStories": [
    {
      "id": "US-001",
      "title": "P1: Investigate and fix menu scrolling issue",
      "description": "As a user, I want the home screen menu to scroll smoothly without issues",
      "acceptanceCriteria": [
        "Investigate lib/screens/home_screen.dart to identify scrolling issue",
        "Document what the issue is (janky, doesn't scroll, wrong physics, etc.)",
        "Implement fix for the scrolling behavior",
        "Test scrolling works smoothly on different screen sizes",
        "flutter test passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": "File: lib/screens/home_screen.dart. Need to investigate first - could be scroll physics, nested scrollables, or layout issue.",
      "dependsOn": []
    },
    {
      "id": "US-002",
      "title": "P1: Investigate and fix arrows not dropping when plotting",
      "description": "As a user, I want arrows to appear on target when I tap to plot them",
      "acceptanceCriteria": [
        "Investigate lib/screens/plotting_screen.dart and lib/widgets/target_face.dart",
        "Identify root cause (touch detection, visual feedback, database save, or state update)",
        "Implement fix for arrow plotting",
        "Test that tapping target plots arrow and shows it visually",
        "Test that arrow is saved to database",
        "flutter test passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Files: lib/screens/plotting_screen.dart, lib/widgets/target_face.dart. Could be gesture conflict with zoom, state not updating, or DB issue.",
      "dependsOn": []
    },
    {
      "id": "US-003",
      "title": "P1: Investigate and fix volume input interface saves",
      "description": "As a user, I want my volume training data to save properly when I enter it",
      "acceptanceCriteria": [
        "Investigate lib/screens/volume_import_screen.dart and database volume tables",
        "Identify what's not saving (manual entry, CSV import, or both)",
        "Implement fix for data persistence",
        "Test manual entry saves correctly",
        "Test CSV import saves correctly",
        "flutter test passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Files: lib/screens/volume_import_screen.dart, lib/db/database.dart (volume tables). Check both manual entry and import flows.",
      "dependsOn": []
    },
    {
      "id": "US-004",
      "title": "P1: Investigate and fix selfie camera",
      "description": "As a user, I want to use the front-facing camera for delayed capture",
      "acceptanceCriteria": [
        "Investigate lib/screens/delayed_camera_native.dart and delayed_camera_web.dart",
        "Identify issue (camera switching, front camera availability, mirror mode)",
        "Implement camera switching functionality if missing",
        "Ensure front camera view is mirrored correctly for selfie use",
        "Test on both native and web platforms",
        "flutter test passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Files: lib/screens/delayed_camera_native.dart, lib/screens/delayed_camera_web.dart. May need platform-specific fixes.",
      "dependsOn": []
    },
    {
      "id": "US-005",
      "title": "P1: Investigate and fix breathing cues visibility",
      "description": "As a user, I want breathing cues to be clearly visible during training",
      "acceptanceCriteria": [
        "Investigate lib/screens/breath_training/*.dart files",
        "Identify visibility issue (text size, contrast, visual indicator size)",
        "Increase text size and contrast for breathing phase indicators",
        "Consider adding larger visual elements (pulsing circle, color changes)",
        "Test visibility in different lighting conditions",
        "flutter test passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Files: lib/screens/breath_training/paced_breathing_screen.dart, patrick_breath_screen.dart, breath_hold_screen.dart. Follow app aesthetic (dark + gold).",
      "dependsOn": []
    },
    {
      "id": "US-006",
      "title": "P1: Investigate and fix haptic feedback / beeps",
      "description": "As a user, I want haptic feedback and audio cues to work during training",
      "acceptanceCriteria": [
        "Investigate lib/services/beep_service.dart and training providers",
        "Identify issue (not triggering, wrong timing, platform differences)",
        "Fix haptic feedback for bow training phase transitions",
        "Fix audio beeps for timing cues",
        "Test on both web and native platforms",
        "Add user settings toggle if not present",
        "flutter test passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": "Files: lib/services/beep_service.dart, lib/providers/bow_training_provider.dart, lib/screens/breath_training/*.dart. Web may need different approach than native.",
      "dependsOn": []
    },
    {
      "id": "US-007",
      "title": "P1: Investigate and improve exhale test structure",
      "description": "As a user, I want a better structured exhale test in breath training",
      "acceptanceCriteria": [
        "Investigate lib/screens/breath_training/breath_hold_screen.dart",
        "Investigate lib/providers/breath_training_provider.dart",
        "Document current exhale test structure",
        "Identify what improvements are needed (phases, timing, instructions)",
        "Implement improved structure based on findings",
        "Test exhale flow works correctly",
        "flutter test passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": "May need to ask Patrick for specific requirements on what the exhale test should look like.",
      "dependsOn": []
    },
    {
      "id": "US-008",
      "title": "P1: Investigate and improve equipment log details",
      "description": "As a user, I want more detailed equipment logging",
      "acceptanceCriteria": [
        "Investigate lib/screens/equipment_screen.dart and bow_form_screen.dart",
        "Investigate lib/providers/equipment_provider.dart",
        "Identify what details are missing (arrow counts, maintenance, usage history)",
        "Add missing fields to equipment forms",
        "Add equipment usage tracking (shots per bow/quiver)",
        "Add maintenance log capability",
        "flutter test passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "May need schema changes in lib/db/database.dart. Keep UI simple per app aesthetic.",
      "dependsOn": []
    },
    {
      "id": "US-009",
      "title": "P1: Implement inter-device data push/sync",
      "description": "As a user, I want my data to sync between phone, tablet, and web",
      "acceptanceCriteria": [
        "Review lib/services/firestore_sync_service.dart for existing sync code",
        "Implement push local data to Firestore",
        "Implement pull remote data to local",
        "Implement conflict resolution (last-write-wins or merge strategy)",
        "Link sync to user authentication",
        "Add manual sync button in settings",
        "Show sync status indicator",
        "flutter test passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "This is a larger feature. Follow offline-first architecture - local is authority, cloud is backup. Consider incremental sync.",
      "dependsOn": []
    },
    {
      "id": "US-010",
      "title": "P2: Kit details auto-prompt on top 20% score",
      "description": "As a user, I want to be prompted to save my kit setup when I achieve a top score",
      "acceptanceCriteria": [
        "Create lib/utils/statistics.dart with percentile calculation",
        "Create KitSnapshots table in database (id, bowId, quiverId, snapshotDate, sessionId, score, settings JSON)",
        "Add migration for new table",
        "After session completion, check if score is in top 20%",
        "Skip prompt if fewer than 5 historical sessions",
        "Show bottom sheet prompt: 'Great score! Save your current kit setup?'",
        "Pre-fill kit details from current default bow/quiver",
        "Save kit snapshot when confirmed",
        "flutter test passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": "Files: lib/db/database.dart, lib/providers/equipment_provider.dart, lib/screens/session_complete_screen.dart, lib/utils/statistics.dart (new). See FIXES_NEEDED.md for full spec.",
      "dependsOn": []
    },
    {
      "id": "US-011",
      "title": "P2: Kit tuning framework - database and models",
      "description": "As a user, I want to track my bow tuning sessions",
      "acceptanceCriteria": [
        "Create TuningSessions table (id, bowId, date, bowType, tuningType, results JSON, notes)",
        "Add migration for new table",
        "Create lib/models/tuning_session.dart data model",
        "tuningType supports: paper, bare_shaft, walk_back, french, cam_timing, etc.",
        "flutter test passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": "First part of kit tuning framework. Schema must support both recurve and compound tuning types.",
      "dependsOn": []
    },
    {
      "id": "US-012",
      "title": "P2: Kit tuning framework - checklist UI",
      "description": "As a user, I want a tuning checklist appropriate for my bow type",
      "acceptanceCriteria": [
        "Create lib/screens/tuning_checklist_screen.dart",
        "Detect bow type from selected bow (recurve vs compound)",
        "Show recurve checklist: brace height, nock point, tiller, centershot, plunger, paper tune, bare shaft",
        "Show compound checklist: paper tune, bare shaft, French tune, cam timing, yoke, rest position, peep height",
        "Allow saving checklist results to TuningSessions table",
        "Add navigation to tuning from equipment screen",
        "flutter test passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": "Follow app aesthetic (dark + gold, monospace fonts). See FIXES_NEEDED.md for checklist items.",
      "dependsOn": ["US-011"]
    },
    {
      "id": "US-013",
      "title": "P2: Kit tuning framework - paper tune logger",
      "description": "As a user, I want to log paper tune results and get fix suggestions",
      "acceptanceCriteria": [
        "Add paper tune section to tuning screen",
        "Capture tear direction (up/down/left/right/clean)",
        "Capture tear size (small/medium/large)",
        "Store history of paper tune attempts",
        "Create lib/utils/tuning_suggestions.dart with fix suggestions based on tear pattern",
        "Display suggestions after logging tear",
        "flutter test passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": "Standard paper tuning fixes: left tear = weak spine or nock high (recurve), etc.",
      "dependsOn": ["US-011", "US-012"]
    },
    {
      "id": "US-014",
      "title": "P2: Kit tuning framework - history view",
      "description": "As a user, I want to see my tuning history timeline",
      "acceptanceCriteria": [
        "Create lib/screens/tuning_history_screen.dart",
        "Show timeline of tuning sessions for selected bow",
        "Display what was adjusted and results for each session",
        "Link to group analysis to show improvement after tuning",
        "Add navigation from equipment/tuning screens",
        "flutter test passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": "Consider showing correlation between tuning changes and group pattern changes.",
      "dependsOn": ["US-011", "US-012"]
    },
    {
      "id": "US-015",
      "title": "P2: Arrow shaft tracking - specifications",
      "description": "As a user, I want to record detailed specs for my arrows",
      "acceptanceCriteria": [
        "Expand Shafts table with: spine, lengthInches, pointWeight, fletchingType, fletchingColor, nockColor",
        "Add migration for new columns",
        "Create or expand lib/screens/shaft_detail_screen.dart",
        "Add form fields for all arrow specs",
        "Add batch entry option (same specs, different numbers)",
        "flutter test passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": "Part A of arrow tracking. Current Shafts table has: id, quiverId, number, notes, retiredAt.",
      "dependsOn": []
    },
    {
      "id": "US-016",
      "title": "P2: Arrow shaft tracking - shot tracking",
      "description": "As a user, I want to track which numbered arrow I shot for each plot",
      "acceptanceCriteria": [
        "Add nullable shaftId column to Arrows table",
        "Add migration for new column",
        "Add shaft selector in plotting UI (quick picker with arrow numbers 1-12)",
        "Auto-advance to next arrow number after plotting",
        "Allow retroactive assignment (tap plotted arrow to assign number)",
        "flutter test passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": "Part B of arrow tracking. Files: lib/db/database.dart, lib/widgets/target_face.dart or lib/screens/plotting_screen.dart.",
      "dependsOn": ["US-015"]
    },
    {
      "id": "US-017",
      "title": "P2: Arrow shaft tracking - per-shaft analysis",
      "description": "As a user, I want to see performance stats for each individual arrow",
      "acceptanceCriteria": [
        "Create lib/utils/shaft_analysis.dart",
        "Calculate per-arrow: average position, group spread, score distribution",
        "Detect outliers (e.g., arrow #5 groups 40% wider than others)",
        "Create lib/screens/shaft_analysis_screen.dart",
        "Show each arrow's performance stats",
        "Add heatmap overlay option (color by arrow number)",
        "Show recommendations (e.g., 'Consider retiring arrow #5')",
        "flutter test passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": "This enables archers to identify problem arrows. Include overlap/robin-hood probability calculation.",
      "dependsOn": ["US-015", "US-016"]
    },
    {
      "id": "US-018",
      "title": "Final verification and commit",
      "description": "As a developer, I want all changes committed with passing tests",
      "acceptanceCriteria": [
        "Run flutter test - ALL tests must pass",
        "Run flutter analyze - no errors (warnings OK)",
        "Update FIXES_NEEDED.md to mark completed items as FIXED with date",
        "Commit all changes with descriptive message",
        "Push to branch",
        "Report summary of what was fixed"
      ],
      "priority": 18,
      "passes": false,
      "notes": "Final verification. Do not proceed if any tests fail.",
      "dependsOn": ["US-001", "US-002", "US-003", "US-004", "US-005", "US-006", "US-007", "US-008", "US-009", "US-010", "US-014", "US-017"]
    }
  ],
  "metadata": {
    "createdAt": "2026-01-16T14:00:00.000Z",
    "estimatedIterations": 18,
    "purpose": "Complete all outstanding P1 investigations/fixes and P2 feature implementations from FIXES_NEEDED.md"
  }
}
