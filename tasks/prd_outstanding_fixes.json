{
  "id": "prd-outstanding-fixes-2026-01",
  "title": "Archery Super App - Outstanding Fixes & Features",
  "version": "1.0",
  "date": "2026-01-17",
  "status": "approved",
  "features": [
    {
      "id": "kit-auto-prompt",
      "title": "Kit Details Auto-Prompt on Top 20% Score",
      "priority": "P2",
      "status": "ready",
      "description": "When an archer achieves a score in their top 20% historically, prompt to save current kit configuration.",
      "trigger_logic": {
        "condition": "current_score >= 80th_percentile",
        "minimum_sessions": 5,
        "timing": "after_session_complete"
      },
      "deliverables": [
        {
          "file": "lib/utils/statistics.dart",
          "description": "Percentile calculation utility",
          "status": "pending"
        },
        {
          "file": "lib/models/kit_snapshot.dart",
          "description": "KitSnapshot model",
          "status": "pending"
        },
        {
          "file": "lib/db/database.dart",
          "description": "Database migration - KitSnapshots table",
          "table_schema": {
            "name": "KitSnapshots",
            "columns": [
              {"name": "id", "type": "integer", "primary_key": true},
              {"name": "bowId", "type": "integer", "nullable": true},
              {"name": "quiverId", "type": "integer", "nullable": true},
              {"name": "snapshotDate", "type": "datetime"},
              {"name": "sessionId", "type": "integer", "nullable": true},
              {"name": "score", "type": "integer", "nullable": true},
              {"name": "settings", "type": "text", "description": "JSON blob of kit settings"}
            ]
          },
          "status": "pending"
        },
        {
          "file": "lib/providers/equipment_provider.dart",
          "description": "Kit snapshot save/load methods",
          "status": "pending"
        },
        {
          "file": "lib/screens/session_complete_screen.dart",
          "description": "Bottom sheet prompt for saving kit",
          "status": "pending"
        }
      ],
      "acceptance_criteria": [
        "Percentile calculation handles edge cases (empty list, single item)",
        "Prompt only shows when score is top 20%",
        "Prompt does not show with <5 historical sessions",
        "Kit snapshot saves current bow and quiver settings",
        "Kit snapshots viewable from equipment screen"
      ]
    },
    {
      "id": "kit-tuning-framework",
      "title": "Kit Tuning Framework",
      "priority": "P2",
      "status": "ready",
      "description": "Structured way to log and track bow tuning with different checklists for recurve vs compound.",
      "checklists": {
        "recurve": [
          "Brace height",
          "Nock point",
          "Tiller",
          "Centershot",
          "Plunger tension",
          "Paper tune",
          "Bare shaft",
          "Walk-back"
        ],
        "compound": [
          "Cam timing",
          "Yoke tuning",
          "Rest position",
          "Peep height",
          "Paper tune",
          "Bare shaft",
          "French tune"
        ]
      },
      "deliverables": [
        {
          "file": "lib/db/database.dart",
          "description": "Database migration - TuningSessions table",
          "table_schema": {
            "name": "TuningSessions",
            "columns": [
              {"name": "id", "type": "integer", "primary_key": true},
              {"name": "bowId", "type": "integer"},
              {"name": "date", "type": "datetime"},
              {"name": "bowType", "type": "text"},
              {"name": "tuningType", "type": "text"},
              {"name": "results", "type": "text", "description": "JSON blob of tuning results"},
              {"name": "notes", "type": "text", "nullable": true}
            ]
          },
          "status": "pending"
        },
        {
          "file": "lib/models/tuning_session.dart",
          "description": "TuningSession data model",
          "status": "pending"
        },
        {
          "file": "lib/screens/tuning_checklist_screen.dart",
          "description": "Main checklist UI with bow type detection",
          "status": "pending"
        },
        {
          "file": "lib/screens/tuning_history_screen.dart",
          "description": "Timeline of tuning sessions",
          "status": "pending"
        },
        {
          "file": "lib/utils/tuning_suggestions.dart",
          "description": "Auto-suggestions from tear patterns",
          "status": "pending"
        }
      ],
      "paper_tune_logger": {
        "tear_directions": ["up", "down", "left", "right", "clean"],
        "tear_sizes": ["small", "medium", "large"],
        "features": [
          "Capture tear direction and size",
          "Suggest fixes based on tear pattern",
          "Store history of attempts"
        ]
      },
      "acceptance_criteria": [
        "Correct checklist shown based on bow type",
        "Paper tune results logged with suggestions",
        "Tuning history displays timeline",
        "Tuning data persists across sessions"
      ]
    },
    {
      "id": "arrow-shaft-tracking",
      "title": "Arrow Shaft Tracking & Analysis",
      "priority": "P2",
      "status": "ready",
      "description": "Track individual arrow performance for both specs and shot tracking.",
      "deliverables": [
        {
          "file": "lib/db/database.dart",
          "description": "Database migration - Expand Shafts table, add shaftId to Arrows",
          "schema_changes": {
            "shafts_table_additions": [
              {"name": "spine", "type": "integer", "nullable": true},
              {"name": "lengthInches", "type": "real", "nullable": true},
              {"name": "pointWeight", "type": "integer", "nullable": true, "description": "grains"},
              {"name": "fletchingType", "type": "text", "nullable": true},
              {"name": "fletchingColor", "type": "text", "nullable": true},
              {"name": "nockColor", "type": "text", "nullable": true}
            ],
            "arrows_table_additions": [
              {"name": "shaftId", "type": "integer", "nullable": true, "references": "Shafts.id"}
            ]
          },
          "status": "pending"
        },
        {
          "file": "lib/screens/shaft_detail_screen.dart",
          "description": "Spec entry form with batch mode",
          "status": "pending"
        },
        {
          "file": "lib/screens/plotting_screen.dart",
          "description": "Arrow number picker (1-12 chips) modification",
          "status": "pending"
        },
        {
          "file": "lib/utils/shaft_analysis.dart",
          "description": "Per-arrow analysis utilities",
          "analysis_features": [
            "Average position deviation",
            "Group spread per arrow",
            "Score distribution",
            "Outlier detection",
            "Overlap likelihood calculation"
          ],
          "status": "pending"
        },
        {
          "file": "lib/screens/shaft_analysis_screen.dart",
          "description": "Results UI with recommendations",
          "status": "pending"
        }
      ],
      "acceptance_criteria": [
        "Arrow specs can be entered individually or batch",
        "Shaft picker appears during plotting (optional use)",
        "Analysis shows per-arrow performance",
        "Outliers identified with retirement suggestions",
        "Overlap risk warning displays when appropriate"
      ]
    }
  ],
  "investigation_required": [
    {
      "id": "menu-scrolling",
      "title": "Menu Scrolling Issue",
      "priority": "P1",
      "status": "needs_investigation",
      "file": "lib/screens/home_screen.dart",
      "question": "What specific scrolling issue? Janky? Doesn't scroll? Wrong scroll physics?"
    },
    {
      "id": "arrows-not-dropping",
      "title": "Arrows Not Dropping",
      "priority": "P1",
      "status": "needs_investigation",
      "files": ["lib/screens/plotting_screen.dart", "lib/widgets/target_face.dart"],
      "question": "Is it touch detection? Visual feedback? Database not saving?"
    },
    {
      "id": "volume-input-saves",
      "title": "Volume Input Interface Saves",
      "priority": "P1",
      "status": "needs_investigation",
      "files": ["lib/screens/volume_import_screen.dart", "lib/db/database.dart"],
      "question": "What's not saving? Manual entry? CSV import? Both?"
    },
    {
      "id": "inter-device-sync",
      "title": "Inter-Device Data Push",
      "priority": "P1",
      "status": "needs_investigation",
      "file": "lib/services/firestore_sync_service.dart",
      "requirements": [
        "Push local data to Firestore",
        "Pull remote data to local",
        "Conflict resolution strategy needed",
        "User authentication linkage"
      ]
    },
    {
      "id": "selfie-camera",
      "title": "Selfie Camera",
      "priority": "P1",
      "status": "needs_investigation",
      "files": ["lib/screens/delayed_camera_native.dart", "lib/screens/delayed_camera_web.dart"],
      "question": "Camera switching? Front camera not available? Mirror mode?"
    },
    {
      "id": "breathing-cues-visibility",
      "title": "Breathing Cues Visibility",
      "priority": "P1",
      "status": "needs_investigation",
      "files": ["lib/screens/breath_training/*.dart"],
      "question": "Text too small? Low contrast? Need larger visual indicator?"
    },
    {
      "id": "haptic-feedback",
      "title": "Haptic Feedback / Beeps",
      "priority": "P1",
      "status": "needs_investigation",
      "files": ["lib/services/beep_service.dart", "lib/providers/bow_training_provider.dart"],
      "question": "Not triggering? Wrong timing? Web vs native differences?"
    },
    {
      "id": "exhale-test-structure",
      "title": "Exhale Test Structure Edit",
      "priority": "P1",
      "status": "needs_investigation",
      "files": ["lib/screens/breath_training/breath_hold_screen.dart"],
      "question": "What structure changes needed? Different phases? Timing adjustments?"
    },
    {
      "id": "equipment-log-details",
      "title": "Equipment Log Details",
      "priority": "P1",
      "status": "needs_investigation",
      "files": ["lib/screens/equipment_screen.dart", "lib/screens/bow_form_screen.dart"],
      "question": "What details missing? Arrow counts? Maintenance logs? Usage history?"
    }
  ],
  "backlog": [
    {
      "id": "clicks-per-ring",
      "title": "Clicks-Per-Ring Training",
      "description": "User-defined exercise to learn sight adjustment ratios"
    },
    {
      "id": "252-scheme-tracker",
      "title": "252 Scheme Tracker",
      "description": "Club progression system tracking 36-arrow imperial rounds"
    },
    {
      "id": "group-visualization",
      "title": "Group Visualization",
      "description": "Spread ellipse, arrow trails by end, ring notation sizing"
    },
    {
      "id": "score-sanity-checks",
      "title": "Score Sanity Checks",
      "description": "Flag perfect scores, huge handicap jumps for verification"
    }
  ],
  "implementation_order": [
    "kit-auto-prompt",
    "arrow-shaft-tracking",
    "kit-tuning-framework"
  ],
  "technical_notes": {
    "offline_first": "All features must work without network. Database changes use local SQLite (Drift). Sync features handle offline gracefully.",
    "design_compliance": {
      "colors": "Dark base + Gold (#FFD700) primary",
      "fonts": "Monospace only (VT323, Share Tech Mono)",
      "grid": "8px",
      "animation": "Minimal"
    }
  }
}
